# 오늘의 작업일지 (2025-08-22): 회원관리 기능 완성

## 1. 목표

- 역할분담에 따른 '회원관리' 백엔드 기능 전체 구현
- Spring Boot, JPA, Spring Security, JWT 등 핵심 기술을 적용하여 실무적인 개발 역량 향상

## 2. 초기 분석 및 계획 수립

- `유기_실종동물...설계 문서.md`와 `역활분담.md` 파일을 분석하여 프로젝트의 목표와 담당 역할을 명확히 함.
- 담당 역할(회원관리)에 대한 체계적인 실력 향상 로드맵(`yyj.md`)을 5단계(Phase)로 나누어 수립함.

## 3. 핵심 기능 구현 및 디버깅 과정

### 3.1. 1단계: 기본 모델링 (Entity/DTO)

- `BaseEntity`, `User` Entity, `Role` Enum을 생성하며 JPA의 기본 개념을 적용함.
- 각 API의 목적에 맞는 `UserSignupRequestDTO`, `UserLoginRequestDTO` 등 다양한 DTO를 설계하고 그 이유를 학습함.

### 3.2. 2단계: 인증/인가 시스템 구축 (Spring Security & JWT)

- `SecurityConfig`를 통해 Spring Security의 기본 구조를 설정함.
- `JwtUtil`을 통해 JWT(Access Token, Refresh Token) 생성 및 검증 로직을 구현함.
- `JwtAuthenticationFilter`를 구현하여 매 요청마다 토큰을 검증하는 인증 시스템의 뼈대를 완성함.

### 3.3. 주요 디버깅 및 문제 해결 과정

오늘 개발 과정에서 여러 중요한 문제들을 만나고 해결했습니다.

- **`403 Forbidden` 에러:**
  - **문제:** `permitAll`로 허용한 `/api/auth/signup` 경로에 접근이 차단되는 현상.
  - **해결:** `JwtAuthenticationFilter`가 비어있는 요청에도 영향을 주는 것을 확인. `HttpSecurity` 설정 대신, `WebSecurityCustomizer`를 사용하여 공개 경로들을 보안 필터 체인에서 완전히 무시하도록 변경하여 근본적으로 문제를 해결함.

- **`500 Internal Server Error` (Enum 관련):**
  - **문제:** `No enum constant ...Role.User` 에러 발생.
  - **해결:** 이전 테스트에서 잘못된 데이터가 DB에 저장된 것을 원인으로 파악. `application.properties`에 `spring.jpa.hibernate.ddl-auto=create` 설정을 추가하여 DB를 초기화함으로써 문제를 해결함. 이후 데이터 유지를 위해 `update`로 변경.

- **`ClassNotFoundException`:**
  - **문제:** `UserRepository` 클래스를 찾을 수 없다는 에러.
  - **해결:** 빌드 과정의 문제로 판단, `gradlew clean build` 명령을 통해 프로젝트를 깨끗하게 재빌드하여 해결함.

- **다수의 컴파일 에러:**
  - **문제:** `cannot find symbol`, `; expected` 등 다수의 문법 오류 발생.
  - **원인:** 제가 `replace` 명령을 사용하는 과정에서 파일 내용이 중복되거나 누락되는 실수가 반복됨.
  - **해결:** 최종적으로 `write_file`을 사용하여 파일 전체를 올바른 코드로 덮어쓰는 방식으로 수정하여 안정성을 확보함.

## 4. API 설계 개선 (사용자 주도)

사용자님의 날카로운 지적과 제안을 통해 API의 완성도를 크게 높였습니다.

- **`201 Created` 적용:** 회원가입 성공 시, `200 OK` 대신 REST API 표준에 더 적합한 `201 Created` 코드를 반환하도록 개선함.
- **구조적 응답 형식 도입:** 모든 API 응답을 `CommonResponse<T>`라는 공용 DTO로 감싸, 일관되고 구조적인 응답 형식을 갖추도록 개선함.
- **API 페이로드 최적화:** 로그인 응답 시, 전체 사용자 정보 대신 UI 표시에 필요한 최소한의 정보만 반환하도록 리팩토링함.
- **버그 수정:** 응답 DTO에 `phoneNumber` 필드가 누락된 버그를 발견하고 수정함.

## 5. 최종 산출물

1.  **회원관리 백엔드 API:** CRUD, JWT 인증/재발급, 전역 예외 처리 등 모든 핵심 기능을 포함한 API 완성.
2.  **단위 테스트 코드:** `UserService`의 핵심 로직을 검증하는 JUnit/Mockito 기반의 단위 테스트 코드 작성.
3.  **API 명세서:** `api-spec-user.md` 파일에 완성된 기능의 사용법을 명시.
4.  **작업 일지:** 현재 보고 계신 이 파일.
